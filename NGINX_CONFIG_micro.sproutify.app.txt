# Nginx Configuration for micro.sproutify.app
# Add this to Plesk: Domains → micro.sproutify.app → Apache & nginx Settings → Additional directives for nginx

# CRITICAL: Serve static assets FIRST (before SPA routing)
# Order matters - more specific locations must come first

# Admin assets (subdirectory) - must come before /admin location
location /admin/assets/ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "application/javascript" always;
	try_files $uri =404;
}

# Marketing site assets (root)
location /assets/ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "application/javascript" always;
	try_files $uri =404;
}

# Force correct MIME types for JS files (must come before /admin)
location ~* \.(js|mjs)$ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "application/javascript" always;
	try_files $uri =404;
}

# Force correct MIME types for CSS files (must come before /admin)
location ~* \.css$ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "text/css" always;
	try_files $uri =404;
}

# Force correct MIME types for SVG files
location ~* \.svg$ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "image/svg+xml" always;
	try_files $uri =404;
}

# Admin SPA routing - serve admin/index.html for /admin routes
# This must come AFTER asset locations
location /admin {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	try_files $uri $uri/ /admin/index.html;
}

# Serve index.html for root requests
location = / {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	try_files /index.html =404;
}

# Optional: Cache control for index.html files
location = /index.html {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Cache-Control "no-cache, no-store, must-revalidate" always;
	add_header Pragma "no-cache" always;
	add_header Expires 0 always;
	try_files $uri =404;
}

location = /admin/index.html {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Cache-Control "no-cache, no-store, must-revalidate" always;
	add_header Pragma "no-cache" always;
	add_header Expires 0 always;
}

