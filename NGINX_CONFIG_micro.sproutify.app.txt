# Nginx Configuration for micro.sproutify.app
# Add this to Plesk: Domains → micro.sproutify.app → Apache & nginx Settings → Additional directives for nginx

# CRITICAL: Serve assets directory first (before SPA routing)
# Marketing site assets (root)
location /assets/ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "application/javascript" always;
	try_files $uri =404;
}

# Admin assets (subdirectory)
location /admin/assets/ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "application/javascript" always;
	try_files $uri =404;
}

# Force correct MIME types for JS and CSS files
location ~* \.(js|mjs)$ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "application/javascript" always;
	try_files $uri =404;
}

location ~* \.css$ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "text/css" always;
	try_files $uri =404;
}

location ~* \.svg$ {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Content-Type "image/svg+xml" always;
	try_files $uri =404;
}

# Admin SPA routing - serve admin/index.html for /admin routes
location /admin {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	try_files $uri $uri/ /admin/index.html;
}

# Optional: Cache control for index.html files
location = /index.html {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Cache-Control "no-cache, no-store, must-revalidate" always;
	add_header Pragma "no-cache" always;
	add_header Expires 0 always;
}

location = /admin/index.html {
	root /var/www/vhosts/sweetwaterurbanfarms.com/micro.sproutify.app/httpdocs;
	add_header Cache-Control "no-cache, no-store, must-revalidate" always;
	add_header Pragma "no-cache" always;
	add_header Expires 0 always;
}

